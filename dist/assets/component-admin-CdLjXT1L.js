import{r as e}from"./rolldown-runtime-Ckerh37x.js";import{G as t,P as n,_ as r,a as i,d as a,g as o,j as s,m as c,v as l}from"./component-Layout-DOoomvQR.js";var u=n(`cloud-upload`,[[`path`,{d:`M12 13v8`,key:`1l5pq0`}],[`path`,{d:`M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242`,key:`1pljnt`}],[`path`,{d:`m8 17 4-4 4 4`,key:`1quai1`}]]),d=n(`loader`,[[`path`,{d:`M12 2v4`,key:`3427ic`}],[`path`,{d:`m16.2 7.8 2.9-2.9`,key:`r700ao`}],[`path`,{d:`M18 12h4`,key:`wj9ykh`}],[`path`,{d:`m16.2 16.2 2.9 2.9`,key:`1bxg5t`}],[`path`,{d:`M12 18v4`,key:`jadmvz`}],[`path`,{d:`m4.9 19.1 2.9-2.9`,key:`bwix9q`}],[`path`,{d:`M2 12h4`,key:`j09sii`}],[`path`,{d:`m4.9 4.9 2.9 2.9`,key:`giyufr`}]]);const f=`php.phtml.php3.php4.php5.php7.php8.phps.pht.phar.html.htm.js.jsp.jspx.pl.py.rb.sh.sql.htaccess.htpasswd.exe.com.bat.cmd.pif.scr.vbs.vbe.jar.shtml.shtm.stm.asa.asax.ascx.ashx.asmx.axd.c.cpp.csharp.vb.asp.aspx.asmx.swf.cgi.dll.sys.ps1.psm1.psd1.reg.msi.msp.lnk.inf.application.gadget.hta.cpl.msc.ws.wsf.wsh.jse`.split(`.`);var p=e(t(),1),m=e(r(),1);const h=({isOpen:e,onClose:t,onSave:n,articleId:r,doc:a,language:d})=>{let{language:h}=o(),g=d||h,[_,v]=(0,p.useState)({sort_order:0}),[y,b]=(0,p.useState)(null),[x,S]=(0,p.useState)(``),[C,w]=(0,p.useState)(!1);(0,p.useEffect)(()=>{v(a||{display_name_bn:``,display_name_en:``,description_bn:``,description_en:``,download_url:``,sort_order:0}),b(null),S(``)},[a]);let T=e=>{if(e.target.files){let t=e.target.files[0],n=t.name.split(`.`).pop()?.toLowerCase()||``;if(f.includes(n)){S(`File type not allowed (potentially dangerous): .${n}`);return}b(t)}},E=async e=>{e.preventDefault(),w(!0),S(``);let t=new FormData;for(let e in t.append(`article_id`,r),a?.id&&t.append(`id`,a.id),y&&t.append(`file`,y),_)if(e!==`id`&&e!==`file_path`&&e!==`file_name`&&e!==`file_size`&&e!==`file_type`){let n=_[e];n!=null&&t.append(e,String(n))}try{let e=await i.saveDocument(t);e.success?n():S(e.error||c(`failed_to_save_document`,g))}catch{S(c(`unexpected_error`,g))}finally{w(!1)}};return e?(0,m.jsx)(`div`,{role:`dialog`,"aria-modal":`true`,"aria-label":c(a?`edit_document`:`add_document`,g),className:`fixed inset-0 bg-black/50 z-[200] flex items-center justify-center p-4 backdrop-blur-sm`,onClick:t,onKeyDown:e=>{e.key===`Escape`&&t()},tabIndex:-1,children:(0,m.jsxs)(`div`,{role:`document`,"aria-label":a?`${c(`edit_document`,g)} ${c(`form`,g)}`:`${c(`add_document`,g)} ${c(`form`,g)}`,className:`bg-card rounded-xl shadow-2xl border max-w-2xl w-full max-h-[90vh] overflow-y-auto`,onClick:e=>e.stopPropagation(),onKeyDown:e=>e.stopPropagation(),children:[(0,m.jsxs)(`div`,{className:`sticky top-0 bg-card/80 backdrop-blur-md border-b p-4 flex items-center justify-between z-10`,children:[(0,m.jsx)(`h3`,{className:`text-xl font-bold`,children:c(a?`edit_document`:`add_document`,g)}),(0,m.jsx)(`button`,{type:`button`,onClick:t,children:(0,m.jsx)(l,{})})]}),(0,m.jsxs)(`form`,{onSubmit:E,className:`p-6 space-y-4`,children:[(0,m.jsxs)(`button`,{type:`button`,onClick:()=>document.getElementById(`file-input`)?.click(),onKeyDown:e=>{(e.key===`Space`||e.key===`Enter`)&&document.getElementById(`file-input`)?.click()},className:`border-2 border-dashed rounded-xl p-8 text-center cursor-pointer w-full text-left`,children:[(0,m.jsx)(u,{className:`w-12 h-12 mx-auto text-muted-text`}),(0,m.jsx)(`p`,{className:`mt-2 text-sm`,children:c(`click_to_upload`,g)}),(0,m.jsx)(`input`,{type:`file`,id:`file-input`,onChange:T,className:`hidden`}),y&&(0,m.jsx)(`p`,{className:`text-success text-sm mt-2`,children:y.name}),!y&&a?.file_name&&(0,m.jsx)(`p`,{className:`text-card-text text-sm mt-2`,children:a.file_name})]}),(0,m.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-2 gap-4`,children:[(0,m.jsx)(`input`,{name:`display_name_bn`,value:_.display_name_bn||``,onChange:e=>v({..._,display_name_bn:e.target.value}),placeholder:c(`name_bn`,g),required:!0,className:`w-full p-2.5 sm:p-3 rounded border bg-muted-bg text-sm sm:text-base`}),(0,m.jsx)(`input`,{name:`display_name_en`,value:_.display_name_en||``,onChange:e=>v({..._,display_name_en:e.target.value}),placeholder:c(`name_en`,g),required:!0,className:`w-full p-2.5 sm:p-3 rounded border bg-muted-bg text-sm sm:text-base`})]}),(0,m.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-2 gap-4`,children:[(0,m.jsx)(`textarea`,{name:`description_bn`,value:_.description_bn||``,onChange:e=>v({..._,description_bn:e.target.value}),placeholder:c(`description_bn`,g),rows:3,className:`w-full p-2.5 sm:p-3 rounded border bg-muted-bg text-sm sm:text-base`}),(0,m.jsx)(`textarea`,{name:`description_en`,value:_.description_en||``,onChange:e=>v({..._,description_en:e.target.value}),placeholder:c(`description_en`,g),rows:3,className:`w-full p-2.5 sm:p-3 rounded border bg-muted-bg text-sm sm:text-base`})]}),(0,m.jsx)(`input`,{type:`url`,name:`download_url`,value:_.download_url||``,onChange:e=>v({..._,download_url:e.target.value}),placeholder:c(`external_url_optional`,g),className:`w-full p-2.5 sm:p-3 rounded border bg-muted-bg text-sm sm:text-base`}),(0,m.jsx)(`input`,{type:`number`,name:`sort_order`,value:_.sort_order||0,onChange:e=>v({..._,sort_order:parseInt(e.target.value,10)}),placeholder:c(`sort_order`,g),className:`w-full p-2.5 sm:p-3 rounded border bg-muted-bg text-sm sm:text-base`}),x&&(0,m.jsxs)(`div`,{className:`text-danger text-sm p-2 bg-danger/10 rounded`,children:[(0,m.jsx)(s,{className:`inline w-4 h-4 mr-2`}),x]}),(0,m.jsxs)(`div`,{className:`flex justify-end gap-2 pt-4 border-t`,children:[(0,m.jsx)(`button`,{type:`button`,onClick:t,className:`px-4 py-2 text-sm font-bold`,children:c(`cancel`,g)}),(0,m.jsx)(`button`,{type:`submit`,disabled:C,className:`px-4 py-2 bg-bbcRed text-white rounded-lg font-bold text-sm disabled:opacity-50`,children:c(C?`saving`:`save`,g)})]})]})]})}):null},g=({isOpen:e,user:t,onClose:n,onSuccess:r})=>{let[o,s]=(0,p.useState)({email:``,role:`user`,password:``}),[c,u]=(0,p.useState)(!1),[f,h]=(0,p.useState)(``);(0,p.useEffect)(()=>{s(t||{email:``,role:`user`,password:``}),h(``)},[t]);let g=()=>o.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o.email)?!t&&!o.password?(h(`নতুন ব্যবহারকারীর জন্য পাসওয়ার্ড প্রয়োজন`),!1):!t&&o.password&&o.password.length<6?(h(`পাসওয়ার্ড কমপক্ষে 6 অক্ষর হওয়া উচিত`),!1):!0:(h(`বৈধ ইমেল প্রবেश করুন`),!1):(h(`ইমেল প্রয়োজন`),!1);return e?(0,m.jsx)(`div`,{className:`fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm`,children:(0,m.jsxs)(`div`,{className:`bg-card rounded-2xl shadow-2xl border border-border-color w-full max-w-md mx-4 animate-in zoom-in-95`,children:[(0,m.jsxs)(`div`,{className:`flex items-center justify-between p-4 sm:p-6 border-b border-border-color`,children:[(0,m.jsx)(`h2`,{className:`text-lg font-bold`,children:t?.id?`ব্যবহারকারী সম্পাদনা করুন`:`নতুন ব্যবহারকারী তৈরি করুন`}),(0,m.jsx)(`button`,{type:`button`,onClick:n,className:`p-2 hover:bg-muted-bg rounded-lg transition-colors`,children:(0,m.jsx)(l,{className:`w-5 h-5`})})]}),(0,m.jsxs)(`form`,{onSubmit:async e=>{if(e.preventDefault(),g()){u(!0);try{if(t?.id){let e=await i.updateUser(t.id,{email:o.email,role:o.role,password:o.password||void 0});e.success?(a(`ব্যবহারকারী সফলভাবে আপডেট হয়েছে`),r(),n()):h(e.error||`ব্যবহারকারী আপডেট করতে ব্যর্থ`)}else{let e=await i.createUser({email:o.email,password:o.password||``,role:o.role});e.success?(a(`ব্যবহারকারী সফলভাবে তৈরি হয়েছে`),r(),n()):h(e.error||`ব্যবহারকারী তৈরি করতে ব্যর্থ`)}}catch{h(`সার্ভার ত্রুটি`)}finally{u(!1)}}},className:`p-4 sm:p-6 space-y-4`,children:[f&&(0,m.jsx)(`div`,{className:`p-3 bg-danger/10 border border-danger/30 rounded-lg text-danger text-sm`,children:f}),(0,m.jsxs)(`div`,{children:[(0,m.jsx)(`label`,{htmlFor:`email`,className:`block text-sm font-bold mb-2`,children:`ইমেল`}),(0,m.jsx)(`input`,{id:`email`,type:`email`,value:o.email,onChange:e=>{s(t=>({...t,email:e.target.value})),h(``)},className:`w-full px-4 py-2 rounded-lg border border-border-color bg-muted-bg text-card-text focus:ring-2 focus:ring-bbcRed/20 focus:border-bbcRed outline-none transition-all`,placeholder:`user@example.com`})]}),(0,m.jsxs)(`div`,{children:[(0,m.jsx)(`label`,{htmlFor:`role`,className:`block text-sm font-bold mb-2`,children:`ভূমিকা`}),(0,m.jsxs)(`select`,{id:`role`,value:o.role,onChange:e=>s(t=>({...t,role:e.target.value})),className:`w-full px-4 py-2 rounded-lg border border-border-color bg-muted-bg text-card-text focus:ring-2 focus:ring-bbcRed/20 focus:border-bbcRed outline-none transition-all`,children:[(0,m.jsx)(`option`,{value:`user`,children:`ব্যবহারকারী`}),(0,m.jsx)(`option`,{value:`admin`,children:`অ্যাডমিন`})]})]}),(!t?.id||o.password)&&(0,m.jsxs)(`div`,{children:[(0,m.jsx)(`label`,{htmlFor:`password`,className:`block text-sm font-bold mb-2`,children:t?.id?`নতুন পাসওয়ার্ড (ঐচ্ছিক)`:`পাসওয়ার্ড`}),(0,m.jsx)(`input`,{id:`password`,type:`password`,value:o.password||``,onChange:e=>{s(t=>({...t,password:e.target.value})),h(``)},className:`w-full px-4 py-2 rounded-lg border border-border-color bg-muted-bg text-card-text focus:ring-2 focus:ring-bbcRed/20 focus:border-bbcRed outline-none transition-all`,placeholder:t?.id?`ছেড়ে যান অপরিবর্তিত`:`পাসওয়ার্ড প্রবেশ করুন`})]}),(0,m.jsxs)(`div`,{className:`flex gap-3 justify-end pt-4`,children:[(0,m.jsx)(`button`,{type:`button`,onClick:n,className:`px-4 py-2 rounded-lg bg-muted-bg hover:bg-border-color text-card-text font-bold transition-colors`,children:`বাতিল`}),(0,m.jsxs)(`button`,{type:`submit`,disabled:c,className:`px-4 py-2 rounded-lg bg-bbcRed hover:bg-bbcRed/90 text-white font-bold transition-colors disabled:opacity-50 flex items-center gap-2`,children:[c&&(0,m.jsx)(d,{className:`w-4 h-4 animate-spin`}),t?.id?`আপডেট করুন`:`তৈরি করুন`]})]})]})]})}):null};export{d as i,h as n,f as r,g as t};