import{a as e,d as t,f as n,r,v as i}from"./vendor-react-DDJd_2jx.js";import"./vendor-ByUF73EW.js";import{M as a,R as o,U as s,X as c,_ as l,b as u,n as d,q as f,u as p,v as m}from"./vendor-ui-dKvDeG77.js";import"./vendor-tiptap-BzGI3bw4.js";import"./vendor-utils-DddD4xHt.js";import{_ as h,c as g,g as _,h as v,n as y,r as b,s as x}from"./index-CDkAuHRW.js";var S=i(),C=r();const w=({isOpen:e,onClose:t,onSave:n,articleId:r,doc:i})=>{let[a,o]=(0,S.useState)({sort_order:0}),[s,l]=(0,S.useState)(null),[u,p]=(0,S.useState)(``),[m,h]=(0,S.useState)(!1);(0,S.useEffect)(()=>{o(i||{display_name_bn:``,display_name_en:``,description_bn:``,description_en:``,download_url:``,sort_order:0}),l(null),p(``)},[i]);let g=e=>{e.target.files&&l(e.target.files[0])},_=async e=>{e.preventDefault(),h(!0),p(``);let t=new FormData;for(let e in t.append(`article_id`,r),i?.id&&t.append(`id`,i.id),s&&t.append(`file`,s),a)if(e!==`id`&&e!==`file_path`&&e!==`file_name`&&e!==`file_size`&&e!==`file_type`){let n=a[e];n!=null&&t.append(e,String(n))}try{let e=await y.saveDocument(t);e.success?n():p(e.error||`Failed to save document.`)}catch{p(`An unexpected error occurred.`)}finally{h(!1)}};return e?(0,C.jsx)(`div`,{role:`dialog`,"aria-modal":`true`,"aria-label":i?`Edit Document`:`Add Document`,className:`fixed inset-0 bg-black/50 z-[200] flex items-center justify-center p-4 backdrop-blur-sm`,onClick:t,onKeyDown:e=>{e.key===`Escape`&&t()},tabIndex:-1,children:(0,C.jsxs)(`div`,{role:`document`,"aria-label":i?`Edit Document Form`:`Add Document Form`,className:`bg-card rounded-xl shadow-2xl border max-w-2xl w-full max-h-[90vh] overflow-y-auto`,onClick:e=>e.stopPropagation(),onKeyDown:e=>e.stopPropagation(),children:[(0,C.jsxs)(`div`,{className:`sticky top-0 bg-card/80 backdrop-blur-md border-b p-4 flex items-center justify-between z-10`,children:[(0,C.jsx)(`h3`,{className:`text-xl font-bold`,children:i?`Edit Document`:`Add Document`}),(0,C.jsx)(`button`,{type:`button`,onClick:t,children:(0,C.jsx)(d,{})})]}),(0,C.jsxs)(`form`,{onSubmit:_,className:`p-6 space-y-4`,children:[(0,C.jsxs)(`button`,{type:`button`,onClick:()=>document.getElementById(`file-input`)?.click(),onKeyDown:e=>{(e.key===`Space`||e.key===`Enter`)&&document.getElementById(`file-input`)?.click()},className:`border-2 border-dashed rounded-xl p-8 text-center cursor-pointer w-full text-left`,children:[(0,C.jsx)(f,{className:`w-12 h-12 mx-auto text-muted-text`}),(0,C.jsx)(`p`,{className:`mt-2 text-sm`,children:`Click to upload or drag & drop`}),(0,C.jsx)(`input`,{type:`file`,id:`file-input`,onChange:g,className:`hidden`}),s&&(0,C.jsx)(`p`,{className:`text-success text-sm mt-2`,children:s.name}),!s&&i?.file_name&&(0,C.jsx)(`p`,{className:`text-card-text text-sm mt-2`,children:i.file_name})]}),(0,C.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-2 gap-4`,children:[(0,C.jsx)(`input`,{name:`display_name_bn`,value:a.display_name_bn||``,onChange:e=>o({...a,display_name_bn:e.target.value}),placeholder:`Name (BN)`,required:!0,className:`w-full p-2.5 sm:p-3 rounded border bg-muted-bg text-sm sm:text-base`}),(0,C.jsx)(`input`,{name:`display_name_en`,value:a.display_name_en||``,onChange:e=>o({...a,display_name_en:e.target.value}),placeholder:`Name (EN)`,required:!0,className:`w-full p-2.5 sm:p-3 rounded border bg-muted-bg text-sm sm:text-base`})]}),(0,C.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-2 gap-4`,children:[(0,C.jsx)(`textarea`,{name:`description_bn`,value:a.description_bn||``,onChange:e=>o({...a,description_bn:e.target.value}),placeholder:`Description (BN)`,rows:3,className:`w-full p-2.5 sm:p-3 rounded border bg-muted-bg text-sm sm:text-base`}),(0,C.jsx)(`textarea`,{name:`description_en`,value:a.description_en||``,onChange:e=>o({...a,description_en:e.target.value}),placeholder:`Description (EN)`,rows:3,className:`w-full p-2.5 sm:p-3 rounded border bg-muted-bg text-sm sm:text-base`})]}),(0,C.jsx)(`input`,{type:`url`,name:`download_url`,value:a.download_url||``,onChange:e=>o({...a,download_url:e.target.value}),placeholder:`External URL (optional)`,className:`w-full p-2.5 sm:p-3 rounded border bg-muted-bg text-sm sm:text-base`}),(0,C.jsx)(`input`,{type:`number`,name:`sort_order`,value:a.sort_order||0,onChange:e=>o({...a,sort_order:parseInt(e.target.value,10)}),placeholder:`Sort Order`,className:`w-full p-2.5 sm:p-3 rounded border bg-muted-bg text-sm sm:text-base`}),u&&(0,C.jsxs)(`div`,{className:`text-danger text-sm p-2 bg-danger/10 rounded`,children:[(0,C.jsx)(c,{className:`inline w-4 h-4 mr-2`}),u]}),(0,C.jsxs)(`div`,{className:`flex justify-end gap-2 pt-4 border-t`,children:[(0,C.jsx)(`button`,{type:`button`,onClick:t,className:`px-4 py-2 text-sm font-bold`,children:`Cancel`}),(0,C.jsx)(`button`,{type:`submit`,disabled:m,className:`px-4 py-2 bg-bbcRed text-white rounded-lg font-bold text-sm disabled:opacity-50`,children:m?`Saving...`:`Save`})]})]})]})}):null};var T=()=>{let{id:r}=n(),i=t(),{language:c}=h(),[d,f]=(0,S.useState)({}),[T,E]=(0,S.useState)([]),[D,O]=(0,S.useState)([]),[k,A]=(0,S.useState)([]),[j,M]=(0,S.useState)(!0),[N,P]=(0,S.useState)(!1),[F,I]=(0,S.useState)(!1),[L,R]=(0,S.useState)(!1),[z,B]=(0,S.useState)(null),V=(0,S.useRef)(``),H=(0,S.useRef)(``),U=`article-draft-${r||`new`}`,W=(0,S.useCallback)(async()=>{if(r)try{let e=await y.getArticleDocuments(r);e.success&&E(e.documents||[])}catch{v(`Failed to load documents`,`error`)}},[r]);(0,S.useEffect)(()=>{(async()=>{M(!0);try{let[e,t]=await Promise.all([y.getCategories(),y.getSections()]);if(e.success&&e.data&&O(e.data),t.success&&t.data&&A(t.data.map(e=>({...e,title:e.title||`Untitled Section`}))),r){await W();let e=await b.getArticle(r,c);e.success&&e.article?f({id:e.article.id,title_bn:e.article.title_bn||``,title_en:e.article.title_en||``,summary_bn:e.article.summary_bn||``,summary_en:e.article.summary_en||``,content_bn:e.article.content_bn||``,content_en:e.article.content_en||``,image:e.article.image||``,category_id:e.article.category_id||``,section_id:e.article.section_id||``,status:e.article.status,allow_submissions:e.article.allow_submissions}):v(e.error||_(`failed_to_load_article`,c),`error`)}else f({id:`art_${Date.now()}`,status:`draft`,allow_submissions:!1,image:``,category_id:``,section_id:``})}catch{v(_(`server_error`,c),`error`)}finally{M(!1)}})()},[r,c,W]),(0,S.useEffect)(()=>{let e=localStorage.getItem(U);if(e&&!r){let t=JSON.parse(e);(t.content_bn||t.content_en)&&I(!0)}},[U,r]);let G=(0,S.useCallback)(()=>{let e={...d,content_bn:V.current,content_en:H.current};localStorage.setItem(U,JSON.stringify(e))},[d,U]);(0,S.useEffect)(()=>{let e=setTimeout(()=>{G()},2e3);return()=>{clearTimeout(e)}},[G]);let K=(0,S.useCallback)(()=>{let e=localStorage.getItem(U);if(e){let t=JSON.parse(e);f(e=>({...e,...t})),v(_(`draft_restored`,c)),I(!1)}},[U,c]),q=(0,S.useCallback)(async e=>{let t=e.target.files?.[0];if(!t)return;if(t.size>2*1024*1024){v(_(`file_too_large`,c),`error`);return}let n=new FormData;n.append(`image`,t);try{let e=await y.uploadImage(n);e.success&&e.url?(f(t=>({...t,image:e.url})),v(_(`image_uploaded_successfully`,c))):v(e.error||_(`image_upload_failed`,c),`error`)}catch{v(_(`server_error`,c),`error`)}},[c]),J=(0,S.useCallback)(async e=>{e.preventDefault(),P(!0);let t=new FormData,n=d.id||`art_${Date.now()}`;t.append(`id`,n),t.append(`title_bn`,d.title_bn||``),t.append(`title_en`,d.title_en||``),t.append(`summary_bn`,d.summary_bn||``),t.append(`summary_en`,d.summary_en||``),t.append(`content_bn`,V.current),t.append(`content_en`,H.current),t.append(`image`,d.image||``),t.append(`category_id`,d.category_id||``),t.append(`sectionId`,d.section_id||``),t.append(`status`,d.status||`draft`),t.append(`allow_submissions`,d.allow_submissions?`1`:`0`);try{let e=await y.saveArticle(t);e.success?(v(_(`article_saved_successfully`,c)),localStorage.removeItem(U),r||i(`/admin/articles/${e.id}/edit`)):v(e.error||_(`failed_to_save_article`,c),`error`)}catch{v(_(`server_error`,c),`error`)}finally{P(!1)}},[d,r,c,i,U]),Y=async e=>{if(r){if(e){let t=await y.getDocument(e.id);if(t.success&&t.document)B(t.document);else return}else B(null);R(!0)}},X=()=>{R(!1),B(null)},Z=async()=>{await W(),X()},Q=async e=>{if(window.confirm(`Are you sure you want to delete this document?`))try{await y.deleteDocument(e),await W()}catch{}};return j?(0,C.jsx)(`div`,{className:`text-center py-8`,children:(0,C.jsx)(a,{className:`w-10 h-10 animate-spin text-bbcRed`})}):(0,C.jsxs)(`div`,{className:`max-w-6xl mx-auto`,children:[(0,C.jsxs)(`div`,{className:`flex items-center justify-between mb-6`,children:[(0,C.jsx)(`h1`,{className:`text-2xl font-bold`,children:_(r?`edit_article`:`create_new_article_unified`,c)}),r&&(0,C.jsxs)(`div`,{className:`flex gap-2`,children:[(0,C.jsxs)(e,{to:`/article/${r}?lang=bn`,target:`_blank`,className:`text-card-text hover:underline text-sm flex items-center gap-1`,children:[_(`view_bn`,c),` `,(0,C.jsx)(s,{className:`w-3 h-3`})]}),(0,C.jsxs)(e,{to:`/article/${r}?lang=en`,target:`_blank`,className:`text-card-text hover:underline text-sm flex items-center gap-1`,children:[_(`view_en`,c),` `,(0,C.jsx)(s,{className:`w-3 h-3`})]})]})]}),(0,C.jsx)(`form`,{onSubmit:J,className:`space-y-6`,children:(0,C.jsxs)(`div`,{className:`grid grid-cols-1 lg:grid-cols-3 gap-6`,children:[(0,C.jsxs)(`div`,{className:`lg:col-span-2 space-y-6 bg-card p-4 sm:p-6 rounded-xl border border-border-color shadow-sm`,children:[(0,C.jsx)(`h3`,{className:`font-bold text-lg mb-4 border-b border-border-color pb-2`,children:_(`content_unified`,c)}),(0,C.jsxs)(`div`,{children:[(0,C.jsx)(`label`,{htmlFor:`title-bn`,className:`block text-sm font-bold mb-2`,children:_(`title_bn`,c)}),(0,C.jsx)(`input`,{id:`title-bn`,name:`title_bn`,value:d.title_bn||``,onChange:e=>f(t=>({...t,title_bn:e.target.value})),required:!0,className:`w-full p-3 sm:p-2.5 rounded-lg border border-border-color bg-card focus:border-bbcRed outline-none font-hind text-sm sm:text-base`,placeholder:_(`enter_article_title_bn`,c)})]}),(0,C.jsxs)(`div`,{children:[(0,C.jsx)(`label`,{htmlFor:`title-en`,className:`block text-sm font-bold mb-2`,children:_(`title_en`,c)}),(0,C.jsx)(`input`,{id:`title-en`,name:`title_en`,value:d.title_en||``,onChange:e=>f(t=>({...t,title_en:e.target.value})),className:`w-full p-3 sm:p-2.5 rounded-lg border border-border-color bg-card focus:border-bbcRed outline-none font-hind text-sm sm:text-base`,placeholder:_(`enter_article_title_en`,c)})]}),(0,C.jsxs)(`div`,{children:[(0,C.jsx)(`label`,{htmlFor:`summary-bn`,className:`block text-sm font-bold mb-2`,children:_(`summary_bn`,c)}),(0,C.jsx)(`textarea`,{id:`summary-bn`,name:`summary_bn`,rows:3,value:d.summary_bn||``,onChange:e=>f(t=>({...t,summary_bn:e.target.value})),className:`w-full p-3 sm:p-2.5 rounded-lg border border-border-color bg-card focus:border-bbcRed outline-none font-hind text-sm sm:text-base`,placeholder:_(`brief_summary_bn`,c)})]}),(0,C.jsxs)(`div`,{children:[(0,C.jsx)(`label`,{htmlFor:`summary-en`,className:`block text-sm font-bold mb-2`,children:_(`summary_en`,c)}),(0,C.jsx)(`textarea`,{id:`summary-en`,name:`summary_en`,rows:3,value:d.summary_en||``,onChange:e=>f(t=>({...t,summary_en:e.target.value})),className:`w-full p-3 sm:p-2.5 rounded-lg border border-border-color bg-card focus:border-bbcRed outline-none font-hind text-sm sm:text-base`,placeholder:_(`brief_summary_en`,c)})]}),(0,C.jsxs)(`div`,{children:[(0,C.jsx)(`label`,{htmlFor:`content-bn`,className:`block text-sm font-bold mb-2`,children:_(`content_bn`,c)}),(0,C.jsx)(x,{value:d.content_bn||``,onChange:e=>{V.current=e,f(t=>({...t,content_bn:e}))},placeholder:_(`write_in_bengali`,c),height:`400px`,className:`w-full rounded-lg border border-border-color bg-card focus:border-bbcRed`})]}),(0,C.jsxs)(`div`,{children:[(0,C.jsx)(`label`,{htmlFor:`content-en`,className:`block text-sm font-bold mb-2`,children:_(`content_en`,c)}),(0,C.jsx)(x,{value:d.content_en||``,onChange:e=>{H.current=e,f(t=>({...t,content_en:e}))},placeholder:_(`write_in_english`,c),height:`400px`,className:`w-full rounded-lg border border-border-color bg-card focus:border-bbcRed`})]})]}),(0,C.jsxs)(`div`,{className:`space-y-6`,children:[F&&(0,C.jsx)(`div`,{id:`restore-alert`,className:`bg-muted-bg border border-border-color rounded-xl p-4`,children:(0,C.jsxs)(`div`,{className:`flex items-start gap-3`,children:[(0,C.jsx)(l,{className:`w-5 h-5 text-card-text mt-0.5`}),(0,C.jsxs)(`div`,{children:[(0,C.jsx)(`h4`,{className:`text-sm font-bold text-card-text`,children:_(`unsaved_draft_found`,c)}),(0,C.jsx)(`p`,{className:`text-xs text-card-text mt-1`,children:_(`newer_version_found_in_browser`,c)}),(0,C.jsx)(`button`,{type:`button`,onClick:K,className:`mt-2 text-xs bg-card text-card-text px-3 py-1.5 rounded hover:bg-card/90 transition-colors font-bold`,children:_(`restore_draft`,c)})]})]})}),(0,C.jsxs)(`div`,{className:`bg-card p-4 rounded-xl border border-border-color shadow-sm`,children:[(0,C.jsx)(`h3`,{className:`font-bold mb-3 text-sm uppercase text-muted-text`,children:_(`publishing`,c)}),(0,C.jsxs)(`div`,{className:`mb-4`,children:[(0,C.jsx)(`label`,{htmlFor:`status-dropdown`,className:`block text-xs font-bold mb-2`,children:_(`status`,c)}),(0,C.jsx)(g,{id:`status-dropdown`,value:d.status||`draft`,onChange:e=>f(t=>({...t,status:e})),options:[{value:`draft`,label:_(`draft`,c)},{value:`published`,label:_(`published`,c)},{value:`archived`,label:_(`archived`,c)}]})]}),(0,C.jsx)(`div`,{className:`mb-4`,children:(0,C.jsxs)(`label`,{className:`flex items-center gap-2 cursor-pointer`,children:[(0,C.jsx)(`input`,{type:`checkbox`,name:`allow_submissions`,checked:d.allow_submissions||!1,onChange:e=>f(t=>({...t,allow_submissions:e.target.checked})),className:`form-checkbox h-5 w-5 text-bbcRed rounded`}),(0,C.jsx)(`span`,{className:`text-sm font-bold text-card-text`,children:_(`allow_user_submissions`,c)})]})}),(0,C.jsx)(`button`,{type:`submit`,className:`w-full bg-bbcRed text-white py-3 rounded-lg font-bold hover:opacity-90 transition-opacity text-sm uppercase tracking-wide`,disabled:N,children:N?(0,C.jsx)(a,{className:`w-4 h-4 inline animate-spin`}):_(r?`update_all_versions`:`publish_article`,c)})]}),(0,C.jsxs)(`div`,{className:`bg-card p-4 rounded-xl border border-border-color shadow-sm`,children:[(0,C.jsx)(`h3`,{className:`font-bold mb-3 text-sm uppercase text-muted-text`,children:_(`organization`,c)}),(0,C.jsxs)(`div`,{className:`mb-4`,children:[(0,C.jsx)(`label`,{htmlFor:`category-dropdown`,className:`block text-xs font-bold mb-2`,children:_(`category`,c)}),(0,C.jsxs)(`select`,{id:`category-dropdown`,name:`category_id`,value:d.category_id||``,onChange:e=>f(t=>({...t,category_id:e.target.value})),className:`custom-select w-full p-2.5 rounded-lg border border-border-color bg-card text-card-text text-sm`,children:[(0,C.jsx)(`option`,{value:``,children:_(`select_category`,c)}),D.map(e=>(0,C.jsx)(`option`,{value:e.id,children:c===`bn`?e.title_bn:e.title_en},e.id))]})]}),(0,C.jsxs)(`div`,{className:`mb-4`,children:[(0,C.jsx)(`label`,{htmlFor:`section-dropdown`,className:`block text-xs font-bold mb-2`,children:_(`section_homepage`,c)}),(0,C.jsx)(g,{id:`section-dropdown`,value:d.section_id||``,onChange:e=>f(t=>({...t,section_id:e})),options:[{value:``,label:_(`none`,c)},...k.map(e=>({value:e.id,label:e.title||e.title}))]})]})]}),(0,C.jsxs)(`div`,{className:`bg-card p-4 rounded-xl border border-border-color shadow-sm`,children:[(0,C.jsx)(`h3`,{className:`font-bold mb-3 text-sm uppercase text-muted-text`,children:_(`media`,c)}),(0,C.jsxs)(`div`,{className:`mb-4`,children:[(0,C.jsx)(`label`,{htmlFor:`featured-image-url`,className:`block text-xs font-bold mb-1`,children:_(`featured_image_url`,c)}),(0,C.jsx)(`input`,{id:`featured-image-url`,name:`image`,value:d.image||``,onChange:e=>f(t=>({...t,image:e.target.value})),className:`w-full p-2 rounded border border-border-color bg-muted-bg text-sm`})]}),(0,C.jsxs)(`div`,{className:`mb-4`,children:[(0,C.jsx)(`label`,{htmlFor:`image-upload`,className:`block text-xs font-bold mb-1`,children:_(`or_upload`,c)}),(0,C.jsx)(`input`,{id:`image-upload`,type:`file`,onChange:q,className:`w-full text-xs`})]}),(0,C.jsx)(`div`,{className:`aspect-video bg-muted-bg rounded overflow-hidden`,children:(0,C.jsx)(`img`,{id:`image-preview`,src:d.image||``,alt:`Preview`,className:`w-full h-full object-cover ${d.image?``:`opacity-50`}`})})]}),r&&(0,C.jsxs)(`div`,{className:`bg-card p-4 rounded-xl border border-border-color shadow-sm`,children:[(0,C.jsxs)(`div`,{className:`flex justify-between items-center mb-3`,children:[(0,C.jsx)(`h3`,{className:`font-bold text-sm uppercase text-muted-text`,children:_(`documents`,c)}),(0,C.jsxs)(`button`,{type:`button`,onClick:()=>Y(null),className:`text-bbcRed hover:underline text-sm font-bold flex items-center gap-1`,children:[(0,C.jsx)(m,{className:`w-4 h-4`}),_(`add_document`,c)]})]}),(0,C.jsxs)(`div`,{className:`space-y-2`,children:[T.map(e=>(0,C.jsxs)(`div`,{className:`flex items-center justify-between bg-muted-bg p-2 rounded-lg`,children:[(0,C.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,C.jsx)(o,{className:`w-5 h-5 text-muted-text`}),(0,C.jsx)(`span`,{className:`text-sm font-medium`,children:e.display_name_en||e.display_name_bn})]}),(0,C.jsxs)(`div`,{className:`flex items-center gap-1`,children:[(0,C.jsx)(`button`,{type:`button`,onClick:()=>Y(e),className:`p-1.5 hover:bg-black/10 rounded-md`,children:(0,C.jsx)(u,{className:`w-4 h-4`})}),(0,C.jsx)(`button`,{type:`button`,onClick:()=>Q(e.id),className:`p-1.5 hover:bg-danger/10 text-danger rounded-md`,children:(0,C.jsx)(p,{className:`w-4 h-4`})})]})]},e.id)),T.length===0&&(0,C.jsx)(`p`,{className:`text-sm text-muted-text text-center py-4`,children:`No documents attached.`})]})]})]})]})}),L&&r&&(0,C.jsx)(w,{isOpen:L,onClose:X,onSave:Z,articleId:r,doc:z})]})};export{T as default};